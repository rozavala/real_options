Starting orchestrator from /home/rodrigo/real_options...
2026-02-17 17:59:32,478 - Orchestrator - INFO - =============================================
2026-02-17 17:59:32,478 - Orchestrator - INFO - === Starting the Trading Bot Orchestrator ===
2026-02-17 17:59:32,478 - Orchestrator - INFO - =============================================
2026-02-17 17:59:32,480 - ConfigLoader - INFO - Config loaded successfully. Mode: LIVE. Providers: gemini, anthropic, openai, xai
2026-02-17 17:59:32,480 - Orchestrator - WARNING - ============================================================
2026-02-17 17:59:32,480 - Orchestrator - WARNING -   IB GATEWAY: REMOTE/PAPER (100.102.50.16)
2026-02-17 17:59:32,480 - Orchestrator - WARNING -   Client IDs: DEV range (10-79)
2026-02-17 17:59:32,480 - Orchestrator - WARNING -   Trading Mode: LIVE
2026-02-17 17:59:32,480 - Orchestrator - WARNING - ============================================================
2026-02-17 17:59:32,480 - Orchestrator - INFO - Budget Guard initialized. Daily limit: $15.0
2026-02-17 17:59:32,480 - trading_bot.drawdown_circuit_breaker - INFO - Loaded drawdown state: NORMAL (0.00%)
2026-02-17 17:59:32,480 - Orchestrator - INFO - Drawdown Guard initialized.
2026-02-17 17:59:32,480 - Orchestrator - INFO - Expiry filter window: 45-365 DTE
2026-02-17 17:59:32,599 - Orchestrator - INFO - --- Processing Deferred Triggers ---
2026-02-17 17:59:32,600 - Orchestrator - INFO - No deferred triggers to process.
2026-02-17 17:59:32,600 - Orchestrator - INFO - Built session schedule: 17 tasks for KC (04:15-13:30 ET)
2026-02-17 17:59:32,600 - Orchestrator - INFO - Environment: DEV. Applying 0 minute 'Civil War' avoidance offset.
2026-02-17 17:59:32,603 - Orchestrator - WARNING - ‚ö†Ô∏è LATE START DETECTED: 9 scheduled tasks already passed:
  - 03:30 ET: start_monitoring
  - 03:31 ET: process_deferred_triggers
  - 04:00 ET: cleanup_orphaned_theses
  - 04:42 ET: signal_open
  - 07:01 ET: signal_early
  - 08:52 ET: audit_mid_session
  - 09:20 ET: signal_mid
  - 11:39 ET: signal_late
  - 12:55 ET: audit_pre_close
2026-02-17 17:59:32,604 - Orchestrator - INFO - --- Recovery: Evaluating 9 missed tasks ---
2026-02-17 17:59:32,604 - Orchestrator - INFO - üîÑ RECOVERY: Running missed start_monitoring [start_monitoring] (was scheduled 03:30 ET)
2026-02-17 17:59:32,604 - Orchestrator - INFO - System shutdown flag CLEARED ‚Äî new trading day beginning
2026-02-17 17:59:32,605 - Orchestrator - INFO - --- Starting position monitoring process ---
2026-02-17 17:59:32,606 - Orchestrator - INFO - Successfully started position monitor with PID: 1927486
2026-02-17 17:59:32,606 - Orchestrator - INFO - Started position monitoring service.
2026-02-17 17:59:32,610 - Orchestrator - INFO - ‚úÖ RECOVERY: start_monitoring completed
2026-02-17 17:59:32,611 - Orchestrator - INFO - ‚úÖ ALREADY RAN: process_deferred_triggers completed earlier today (before restart). Skipping re-execution.
2026-02-17 17:59:32,611 - Orchestrator - INFO - üîÑ RECOVERY: Running missed cleanup_orphaned_theses [cleanup_orphaned_theses] (was scheduled 04:00 ET)
2026-02-17 17:59:32,611 - Orchestrator - INFO - --- AUTOMATED THESIS CLEANUP ---
2026-02-17 17:59:32,611 - trading_bot.connection_pool - INFO - Connecting IB (cleanup) ID: 71 [REMOTE/PAPER]...
2026-02-17 17:59:32,819 - trading_bot.connection_pool - INFO - IB (cleanup) connected successfully with ID 71
2026-02-17 17:59:32,855 - chromadb.telemetry.product.posthog - INFO - Anonymized telemetry enabled. See                     https://docs.trychroma.com/telemetry for more information.
2026-02-17 17:59:32,943 - trading_bot.tms - INFO - TMS initialized at ./data/tms
2026-02-17 17:59:33,086 - Orchestrator - INFO - Thesis cleanup: no orphans found
2026-02-17 17:59:33,086 - trading_bot.connection_pool - INFO - Disconnecting IB (cleanup)...
2026-02-17 17:59:36,097 - Orchestrator - INFO - ‚úÖ RECOVERY: cleanup_orphaned_theses completed
2026-02-17 17:59:36,098 - Orchestrator - INFO - ‚úÖ ALREADY RAN: signal_open completed earlier today (before restart). Skipping re-execution.
2026-02-17 17:59:36,098 - Orchestrator - INFO - ‚úÖ ALREADY RAN: signal_early completed earlier today (before restart). Skipping re-execution.
2026-02-17 17:59:36,098 - Orchestrator - INFO - üîÑ RECOVERY: Running missed audit_mid_session [run_position_audit_cycle] (was scheduled 08:52 ET)
2026-02-17 17:59:36,098 - Orchestrator - INFO - --- POSITION AUDIT CYCLE (Scheduled) ---
2026-02-17 17:59:36,099 - trading_bot.connection_pool - INFO - Connecting IB (audit) ID: 55 [REMOTE/PAPER]...
2026-02-17 17:59:36,507 - trading_bot.connection_pool - INFO - IB (audit) connected successfully with ID 55
2026-02-17 17:59:36,519 - trading_bot.utils - INFO - üõ†Ô∏è FORCE_DELAYED_DATA enabled: Using Delayed Market Data (Type 3)
2026-02-17 17:59:36,564 - trading_bot.tms - INFO - TMS initialized at ./data/tms
2026-02-17 17:59:36,589 - Orchestrator - WARNING - State sync discrepancy: IBKR has 0 positions but ledger shows 1 open
2026-02-17 17:59:36,841 - notifications - INFO - Pushover chunk sent successfully (Attachment: False).
2026-02-17 17:59:36,843 - Orchestrator - WARNING - Proceeding with audit despite 1 discrepancies. IBKR positions are source of truth.
2026-02-17 17:59:36,844 - Orchestrator - INFO - 2026-02-17 17:59:36,724 - ConfigLoader - INFO - Config loaded successfully. Mode: LIVE. Providers: gemini, anthropic, openai, xai
2026-02-17 17:59:36,844 - Orchestrator - INFO - 2026-02-17 17:59:36,725 - trading_bot.connection_pool - INFO - Connecting IB (monitor) ID: 29 [REMOTE/PAPER]...
2026-02-17 17:59:37,151 - Orchestrator - INFO - No open positions to audit.
2026-02-17 17:59:37,152 - trading_bot.connection_pool - INFO - Disconnecting IB (audit)...
2026-02-17 17:59:37,292 - Orchestrator - INFO - 2026-02-17 17:59:37,291 - trading_bot.connection_pool - INFO - IB (monitor) connected successfully with ID 29
2026-02-17 17:59:37,296 - Orchestrator - INFO - 2026-02-17 17:59:37,296 - trading_bot.utils - INFO - üõ†Ô∏è FORCE_DELAYED_DATA enabled: Using Delayed Market Data (Type 3)
2026-02-17 17:59:37,296 - Orchestrator - INFO - 2026-02-17 17:59:37,296 - __main__ - INFO - Position monitor connected and watching open positions.
2026-02-17 17:59:37,297 - Orchestrator - INFO - 2026-02-17 17:59:37,296 - root - INFO - Starting intraday P&L monitor. Stop: 50% (Max Risk), Profit: 80% (Capture), Interval: 600s
2026-02-17 17:59:37,297 - Orchestrator - INFO - 2026-02-17 17:59:37,296 - root - INFO - Order status and execution event handlers registered.
2026-02-17 17:59:37,466 - Orchestrator - INFO - 2026-02-17 17:59:37,466 - root - INFO - --- Risk Monitor: Checking 0 combo position(s) ---
2026-02-17 17:59:40,160 - Orchestrator - INFO - ‚úÖ RECOVERY: audit_mid_session completed
2026-02-17 17:59:40,161 - Orchestrator - INFO - ‚úÖ ALREADY RAN: signal_mid completed earlier today (before restart). Skipping re-execution.
2026-02-17 17:59:40,161 - Orchestrator - INFO - ‚úÖ ALREADY RAN: signal_late completed earlier today (before restart). Skipping re-execution.
2026-02-17 17:59:40,161 - Orchestrator - INFO - üîÑ RECOVERY: Running missed audit_pre_close [run_position_audit_cycle] (was scheduled 12:55 ET)
2026-02-17 17:59:40,161 - Orchestrator - INFO - --- POSITION AUDIT CYCLE (Scheduled) ---
2026-02-17 17:59:40,163 - Orchestrator - ERROR - Position Audit Cycle failed: Connection audit in backoff period
Traceback (most recent call last):
  File "/home/rodrigo/real_options/orchestrator.py", line 1561, in run_position_audit_cycle
    ib = await IBConnectionPool.get_connection("audit", config)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/rodrigo/real_options/trading_bot/connection_pool.py", line 142, in get_connection
    raise ConnectionError(f"Connection {purpose} in backoff period")
ConnectionError: Connection audit in backoff period

2026-02-17 17:59:40,167 - Orchestrator - INFO - ‚úÖ RECOVERY: audit_pre_close completed
2026-02-17 17:59:40,167 - Orchestrator - INFO - System restarted with 9 missed tasks.
‚úÖ 4 recovered | ‚è≠Ô∏è 0 skipped | ‚úîÔ∏è 5 already ran
2026-02-17 17:59:40,385 - notifications - INFO - Pushover chunk sent successfully (Attachment: False).
2026-02-17 17:59:40,723 - Orchestrator - INFO - Running TopicDiscoveryAgent on startup...
2026-02-17 17:59:40,775 - trading_bot.topic_discovery - INFO - Starting Topic Discovery Scan...
2026-02-17 17:59:53,604 - trading_bot.tms - INFO - TMS initialized at ./data/tms
2026-02-17 17:59:53,606 - Orchestrator - INFO - Startup TopicDiscovery: 3 topics, No changes
2026-02-17 17:59:53,608 - Orchestrator - INFO - Next task 'close_stale_primary' (Close Stale: Primary) scheduled for 2026-02-17 18:05:00 UTC. Waiting for 0.09 hours.
2026-02-17 17:59:53,608 - Orchestrator - INFO - --- Starting Sentinel Array ---
2026-02-17 17:59:53,979 - Orchestrator - INFO - Market Open: Establishing Sentinel IB connection...
2026-02-17 17:59:53,979 - trading_bot.connection_pool - INFO - Connecting IB (sentinel) ID: 19 [REMOTE/PAPER]...
2026-02-17 17:59:53,980 - trading_bot.self_healing - INFO - Self-Healing Monitor started
2026-02-17 17:59:54,337 - trading_bot.connection_pool - INFO - IB (sentinel) connected successfully with ID 19
2026-02-17 17:59:54,342 - trading_bot.utils - INFO - üõ†Ô∏è FORCE_DELAYED_DATA enabled: Using Delayed Market Data (Type 3)
2026-02-17 17:59:54,342 - Orchestrator - INFO - Sentinel IB connected and injected into PriceSentinel.
2026-02-17 17:59:54,343 - root - INFO - Fetching 1 active futures contracts for KC on NYBOT...
2026-02-17 17:59:54,345 - ConfigLoader - INFO - Config loaded successfully. Mode: LIVE. Providers: gemini, anthropic, openai, xai
2026-02-17 17:59:54,461 - root - INFO - Skipping contract KCH6 (Exp: 20260319): Expires < 45 days.
2026-02-17 17:59:54,462 - root - INFO - Found 10 active tradeable contracts (>=45d exp). Returning the first 1.
2026-02-17 17:59:54,462 - Orchestrator - INFO - Refreshed contract cache: KCK6
2026-02-17 17:59:54,463 - Orchestrator - INFO - Market Open: Engaging Microstructure Sentinel
2026-02-17 17:59:54,463 - trading_bot.connection_pool - INFO - Connecting IB (microstructure) ID: 48 [REMOTE/PAPER]...
2026-02-17 17:59:54,686 - trading_bot.connection_pool - INFO - IB (microstructure) connected successfully with ID 48
2026-02-17 17:59:54,695 - trading_bot.utils - INFO - üõ†Ô∏è FORCE_DELAYED_DATA enabled: Using Delayed Market Data (Type 3)
2026-02-17 17:59:59,881 - trading_bot.rate_limiter - INFO - GlobalRateLimiter initialized: ['gemini', 'openai', 'anthropic', 'xai']
2026-02-17 18:00:26,282 - openai._base_client - INFO - Retrying request to /chat/completions in 0.384471 seconds
2026-02-17 18:04:59,409 - Orchestrator - INFO - Sentinel loop heartbeat: iteration=5, market_open=True, trading_day=True
2026-02-17 18:05:00,001 - Orchestrator - INFO - --- Running scheduled task: close_stale_primary [close_stale_positions] ---
2026-02-17 18:05:00,005 - OrderManager - INFO - --- Initiating position closing based on 2-day holding period ---
2026-02-17 18:05:00,006 - trading_bot.connection_pool - INFO - Connecting IB (orchestrator_orders) ID: 34 [REMOTE/PAPER]...
2026-02-17 18:05:00,306 - trading_bot.connection_pool - INFO - IB (orchestrator_orders) connected successfully with ID 34
2026-02-17 18:05:00,312 - trading_bot.utils - INFO - üõ†Ô∏è FORCE_DELAYED_DATA enabled: Using Delayed Market Data (Type 3)
2026-02-17 18:05:00,312 - OrderManager - INFO - Connected to IB for closing positions (purpose: orchestrator_orders).
2026-02-17 18:05:00,414 - OrderManager - INFO - Found 1 live position legs in the IB account.
2026-02-17 18:05:00,415 - OrderManager - INFO -   Filtered to 0 positions with non-zero quantity (1 already closed/zero-qty excluded)
2026-02-17 18:05:00,415 - OrderManager - INFO - All returned positions have zero quantity ‚Äî nothing to close.
2026-02-17 18:05:00,415 - trading_bot.connection_pool - INFO - Disconnecting IB (orchestrator_orders)...
2026-02-17 18:05:03,421 - Orchestrator - INFO - Next task 'close_stale_fallback' (Close Stale: Fallback) scheduled for 2026-02-17 18:15:00 UTC. Waiting for 0.17 hours.
